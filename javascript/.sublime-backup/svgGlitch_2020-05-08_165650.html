<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style type="text/css">
    	
    	body{
    		background: black;
    	}

	.portrait__canvas{
		width: 300px;
	}

    </style>
</head>

<body>



	<div class="portrait js-portrait">
                            <div class="portrait__inner"> <canvas class="portrait__canvas js-portraitCanvas" data-src="assets/dimar.svg"></canvas> </div>
                        </div>

	

    <script type="text/javascript">
    

    var global = function() {
            var e = {
                    overlay: document.querySelector(".js-overlay"),
                    site: document.querySelector(".js-site"),
                    container: document.querySelector(".js-container"),
                    portrait: document.querySelector(".js-portrait"),
                    portraitCanvas: document.querySelector(".js-portraitCanvas"),

                },
                t = {

                    windowWidth: 800,
                    windowHeight: 800,
                    windowResizeTimer: null,
                    windowResizeTimeout: 100
                };

            return {
                elements: e,
                options: t,
                updateWindow: function() {
                    t.windowWidth = window.innerWidth, t.windowHeight = window.innerHeight
                },
                lerp: function(e, t, n) {
                    return (1 - n) * e + n * t
                },
                randomRange: function(e, t) {
                    return Math.floor(Math.random() * (t - e + 1)) + e
                }

            }
        }(),
        intro = function() {
            var t = {
                overlayDelay: 2e3,
                animDelay: 125,
                animIndex: 0
            };
            return {
                init: function() {
                    // global.elements.overlay.style.opacity = 0;
                    t.animIndex++;
                }
            }
        }(),

        glitchLinks = function() {
            var o = {
                timeMin: 100,
                timeMax: 500,
                delayMin: 1e3,
                delayMax: 5e3
            };


            return {

            }
        }(),
        glitchCanvas = function() {
            var i = {
                ctx: global.elements.portraitCanvas.getContext("2d"),
                image: [],

                imageData: null,
                imageSrc: ["assets/dimar.svg", "assets/dimar.svg"],
                imageLoaded: !1,
                sliceX: 0,
                sliceY: 0,
                sliceHeight: 0,
                minGlitches: 5,
                maxGlitches: 10,
                delayGlitchMin: 50,
                delayGlitchMax: 100,
                delayRestartMin: 1e3,
                delayRestartMax: 5e3
            };

            function e() {
                i.ctx.clearRect(0, 0, global.elements.portraitCanvas.width, global.elements.portraitCanvas.height);
                i.ctx.beginPath();
                i.ctx.fillStyle = "white";
                i.ctx.arc(i.image[0].width / 2, i.image[0].height / 2, 400, 0, 2 * Math.PI);
                i.ctx.fill();
                i.ctx.drawImage(i.image[0], 0, 0, i.image[0].width, i.image[0].height);
                setTimeout(function() {
                    requestAnimationFrame(function() {
                        ! function t(n) {

                            n < global.randomRange(i.minGlitches, i.maxGlitches) ? setTimeout(function() {
                                n++;
                                for (var e = 0; e < global.randomRange(i.minGlitches, i.maxGlitches); e++) o();
                                requestAnimationFrame(function() {
                                    t(n)
                                })
                            }, global.randomRange(i.delayGlitchMin, i.delayGlitchMax)) : e()
                        }(0)
                    })
                }, global.randomRange(i.delayRestartMin, i.delayRestartMax))
            }

            function t() {
                global.elements.portraitCanvas.width = global.options.windowWidth, global.elements.portraitCanvas.height = global.options.windowHeight, requestAnimationFrame(e)
            }

            function o() {
                i.sliceX = Math.round(Math.random() * (global.elements.portraitCanvas.height / 30) - 4),
                    i.sliceY = Math.round(Math.random() * global.elements.portraitCanvas.height),
                    i.sliceHeight = Math.round(Math.random() * (global.elements.portraitCanvas.height / 10) + 1),
                    i.imageData = i.ctx.getImageData(0, i.sliceY, global.elements.portraitCanvas.width, i.sliceHeight),
                    i.ctx.clearRect(0, i.sliceY, global.elements.portraitCanvas.width, i.sliceHeight),
                    i.ctx.putImageData(i.imageData, i.sliceX, i.sliceY)
            }
            return {
                init: function() {
                    console.log('a');
                    i.image[0] = new Image, i.image[0].src = i.imageSrc[0], i.image[0].addEventListener("load", function() {
                        i.imageLoaded = !0, t()
                    })
                    i.image[1] = new Image, i.image[1].src = i.imageSrc[1], i.image[1].addEventListener("load", function() {
                        i.imageLoaded = !0, t()
                    })

                },
                redraw: t
            }
        }();
    window.addEventListener("resize", function() {
        null !== global.options.windowResizeTimer && clearTimeout(global.options.windowResizeTimer), global.options.windowResizeTimer = setTimeout(function() {
            global.updateWindow()
        }, global.options.windowResizeTimeout)
    }, !1), window.addEventListener("load", function() {
        intro.init()
    }, !1), glitchCanvas.init();
    </script>
</body>

</html>