<!DOCTYPE html>
<html>

<head>
    <title></title>
    <script src="../asset/jquery-3.4.1.min.js"></script>
</head>

<body>
    <style type="text/css">
    #thefile {
        position: fixed;
        top: 10px;
        left: 10px;
        z-index: 100;
    }

    #canvas {
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
    }

    audio {
        position: fixed;
        left: 10px;
        bottom: 10px;
        width: calc(100% - 20px);
        opacity: 0.01;
    }

    #senin {
        position: absolute;
        top: 250px;
        font-weight: bolder;
        margin: auto;
        width: 100%;
        text-align: center;
        color: black;
        z-index: 999;
        transition: color ease 0.5s;
        text-shadow: 0px 0px 5px black;
    }

    #bg {
        position: fixed;
        width: 100%;
        height: 100%;
        background-image: url(https://data.1freewallpapers.com/download/girl-umbrella-anime-rain-sadness-1366x768.jpg);


    }

    body {
        margin: 0px;
        overflow: hidden !important;
        overflow-y: hidden;
    }
    </style>
    <div id="bg">
        <style type="text/css">
        body {
            background: black;
        }

        .kotak {
            /*border-radius: 3px;*/
            background: white;
            width: 50px;
            text-align: center;
            box-shadow: 0px 0px 20px black;
            font-size: 50px;
            margin: 0px 2px;
            position: relative;
            transition: box-shadow ease-in-out 0.2s, bottom ease-in-out 0.2s;
        }

        .container-main {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: table;
        }

        .container-center {
            display: table-cell;
            vertical-align: middle;

        }

        .container {
            margin: auto;
            /*bottom: 50%;*/
            /*left: 20%;*/

            position: relative;
            width: max-content;
            /*margin: auto;*/
            display: flex;
        }
        </style>
        <!-- <input type="text" oninput="gnt(this.value)" placeholder="change text disini" id="input"> -->
        <div class="container-main">
            <div class="container-center">
                <div class="container"></div>
            </div>
        </div>
        <script type="text/javascript">
        let text = "skuy".split('');
        let kotak = document.getElementsByClassName('kotak');
        gnt('Dimar')

        function gnt(val) {
            //ganti tulisan
            // change text function
            text = val;

            //membersihkan text dari class container
            //clean container class
            $('.container').html('');

            //menambahkan class kotak kedalam container
            //add class kotak to container
            for (var i = 0; i < text.length; i++) {
                $('.container').append('<div class="kotak">' + text[i] + '</div>');
            }

            kotak = document.getElementsByClassName('kotak');
        }






        let tambah = 0;
        setInterval(function() {
            tambah++;
            for (var x = 0; x < kotak.length; x++) {
                if (tambah % 2 == 0) {
                    let ack = Math.floor(Math.random() * 50);
                    kotak[x].style.bottom = ack + 'px';
                    kotak[x].style.boxShadow = '0px ' + ack + 'px ' + ack + 'px black';
                    // kotak[x].style.marginLeft=ack+'px';
                } else {
                    kotak[x].style.bottom = 0 + 'px';
                    kotak[x].style.boxShadow = '0px 0px 5px black';
                }




            }

        }, 200);
        </script>
    </div>
    <!-- <div id="senin">Hmm...</div> -->
    <div id="content">
        <input type="file" id="thefile" accept="audio/*" />
        <!-- <div style="position: relative;top: 50px;color: red">Pilih File dulu</div> -->
        <canvas id="canvas"></canvas>
        <audio id="audio" controls></audio>
    </div>
    <script type="text/javascript">
    window.onload = function() {

        var file = document.getElementById("thefile");
        var audio = document.getElementById("audio");

        file.onchange = function() {
            var files = this.files;
            audio.src = URL.createObjectURL(files[0]);
            audio.load();
            audio.play();
            var context = new AudioContext();
            var src = context.createMediaElementSource(audio);
            var analyser = context.createAnalyser();

            var canvas = document.getElementById("canvas");
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            var ctx = canvas.getContext("2d");

            src.connect(analyser);
            analyser.connect(context.destination);

            analyser.fftSize = 256;

            var bufferLength = analyser.frequencyBinCount;
            console.log(bufferLength);

            var dataArray = new Uint8Array(bufferLength);

            var WIDTH = canvas.width;
            var HEIGHT = canvas.height;

            var barWidth = (WIDTH / bufferLength) * 2.5;
            var barHeight;
            var x = 0;
            let putar = 0;
            let nputar = 1;
            let nputar2 = 1;
            let snputar = '-';

            function renderFrame() {
                requestAnimationFrame(renderFrame);

                x = 0;

                analyser.getByteFrequencyData(dataArray);
                // console.log(dataArray)
                // document.getElementById('senin').style.fontSize=dataArray[4]/5+'px';
                //putar++;
                // console.log(dataArray[35])
                if (dataArray[35] <= 15) {
                    // document.getElementById('senin').style.color='white';
                } else {
                    // document.getElementById('senin').style.color='aqua';
                }
                if (dataArray[35] == 100 || dataArray[35] >= 200) {



                    if (nputar == nputar2) {
                        nputar2 = nputar + 1;
                        if (putar == 0) {

                            putar = 1;

                            //nputar=2;
                            snputar = '-';
                        } else {
                            snputar = '';
                            putar = 0;
                            //nputar++;
                            // document.getElementById('senin').style.transform='rotate(-'+dataArray[4]/5+'deg)';
                        }
                    } else {
                        nputar = nputar2;
                    }
                }
                document.getElementById('bg').style.transform = 'rotate(' + snputar + dataArray[4] / 35 + 'deg) scale(' + dataArray[4] / 150 + ')';
                document.getElementById('bg').style.filter = 'brightness(' + dataArray[35] / 50 + ')';
                // document.getElementById('senin').style.transform='rotate('+snputar+dataArray[4]/5+'deg)';
                ctx.fillStyle = "hsla(" + 200 + ",100%," + dataArray[35] / 2 + "%,0)";
                for (var zi = 0; zi < document.getElementsByClassName('kotak').length; zi++) {
                    let warna = ['black', 'white', 'black', 'white']
                    document.getElementsByClassName('kotak')[zi].style.backgroundColor = warna[Math.floor(Math.random() * 2)];
                    document.getElementsByClassName('kotak')[zi].style.color = warna[Math.floor(Math.random() * 2)];

                    if (zi % 2 == 0) {
                        document.getElementsByClassName('kotak')[zi].style.transform = 'rotate(' + dataArray[zi * 2] / 10 + 'deg)';
                    } else {
                        document.getElementsByClassName('kotak')[zi].style.transform = 'rotate(-' + dataArray[zi * 2] / 10 + 'deg)';
                    }

                    document.getElementsByClassName('kotak')[zi].style.marginLeft = dataArray[zi * 2] / 5 + 'px';
                }
                ctx.fillRect(0, 0, WIDTH, HEIGHT);


            }

            audio.play();
            renderFrame();
        };
    };
    </script>
</body>

</html>